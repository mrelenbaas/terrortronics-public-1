<!DOCTYPE html>
<html>
<head>
	<title>Geocoding Service</title>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=[YOUR_API_KEY]&callback=initMap&libraries=&v=weekly"
			defer></script>
	<script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>
	<style type="text/css">
		#map {
			height: 100%;
		}

		/* Optional: Makes the sample page fill the window. */
		html,
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		#floating-panel {
			position: absolute;
			top: 10px;
			left: 25%;
			z-index: 5;
			background-color: #fff;
			padding: 5px;
			border: 1px solid #999;
			text-align: center;
			font-family: "Roboto", "sans-serif";
			line-height: 30px;
			padding-left: 10px;
		}
	</style>

	<style type="text/css">
		@font-face {
			font-family: "myFirstFont";
			src: url("..\\..\\Cutive\\Cutive-Regular.ttf");
		}

		.harlow {
			font-family: "myFirstFont";
		}
	</style>

	<script>
		var counter = 0;
		var iconImage = '..\\..\\icon.png';
		window.counter = counter;
		window.iconImage = iconImage;
		window.locations = [
			{
                firstName: 'Nerdery', lastName: 'IGDA', city: 'Edina', lat: 44.8896866, lng: -93.3499489,
                get getCity() {
                    return this.city;
				},
				get getFirstName() {
					return this.firstName;
				},
				get getLastName() {
					return this.lastName;
                }
			},
		];
		var lastFirstName = " ";
        var lastLastName = " ";
        var lastCity = " ";
        var lastState = " ";
        var lastCountry = " ";
        var lastLat = 0.0;
		var lastLng = 0.0;
		var previousFirstName = "xxx";
		var previousLastName = "xxx";
		window.lastFirstName = lastFirstName;
		window.lastLastName = lastLastName;
		window.lastCity = lastCity;
		window.lastState = lastState;
		window.lastCountry = lastCountry;
        window.lastLat = lastLat;
		window.lastLng = lastLng;
		window.previousFirstName = previousFirstName;
		window.previousLastName = previousLastName;
	</script>

	<script type="text/javascript">
		(async function () {
			await CefSharp.BindObjectAsync("boundAsync", "bound");
			boundAsync.read().then(function (res) {});
		})();
	</script>

	<script>
		function callbackFunction() {
			(async () => {
				await CefSharp.BindObjectAsync("boundAsync2", "bound");
				boundAsync.hello(window.lastLat + "," + window.lastLng).then(function (res) {});
				window.counter += 1;
			})();
		}
	</script>

	<script>
		// Markers: https://developers.google.com/maps/documentation/javascript/markers
		// Marker Clustering: https://developers.google.com/maps/documentation/javascript/marker-clustering#maps_marker_clustering-javascript
		function initMap() {
            let x = 44.8896866;
            let y = -93.3499489;
			if (window.lastLat) {
				x = window.lastLat;
				y = window.lastLng;
			}
			const map = new google.maps.Map(document.getElementById("map"), {
				zoom: 8,
                center: { lat: x, lng: y },
				gestureHandling: 'greedy',
				streetViewControl: false,
				disableDefaultUI: true,
				zoomControl: true,
				styles: [
					{
						'featureType': 'administrative',
						'elementType': 'labels.text.fill',
						'stylers': [{ 'color': '#444444' }]
					},
					{
						'featureType': 'landscape',
						'elementType': 'all',
						'stylers': [{ 'color': '#f2f2f2' }]
					},
					{
						'featureType': 'poi',
						'elementType': 'all',
						'stylers': [{ 'visibility': 'off' }]
					},
					{
						'featureType': 'road',
						'elementType': 'all',
						'stylers': [{ 'saturation': -100 }, { 'lightness': 45 }]
					},
					{
						'featureType': 'road.highway',
						'elementType': 'all',
						'stylers': [{ 'visibility': 'off' }]
					},
					{
						'featureType': 'road.arterial',
						'elementType': 'labels.icon',
						'stylers': [{ 'visibility': 'off' }]
					},
					{
						'featureType': 'transit',
						'elementType': 'all',
						'stylers': [{ 'visibility': 'off' }]
					},
					{
						'featureType': 'water',
						'elementType': 'all',
						'stylers': [{ 'color': '#77aed5' }, { 'visibility': 'on' }]
                    },
                ]
			});
			const geocoder = new google.maps.Geocoder();
			document.getElementById("submit").addEventListener("click", () => {
				geocodeAddress(geocoder, map);
			});
			const labels = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
			const markers = window.locations.map((location, i) => {
				const infowindow = new google.maps.InfoWindow({
                    //content: '<h1 class="harlow" style="color:#75aed9; text-align:center;">' + parseInitial(location.getFirstName) + '' + parseInitial(location.getLastName) + '<br/>' + capitalizeFirst(location.getCity) + '</h1>',
                    content: '<h1 class="harlow" style="color:#75aed9; text-align:center;">' + location.getFirstName + ' ' + location.getLastName + '<br/>' + capitalizeFirst(location.getCity) + '</h1>',
                });
				var marker = new google.maps.Marker({
					position: location,
				});
				marker.setIcon(iconImage);
                //marker.addListener("click", () => {
                //    infowindow.open(map, marker);
				//});

				var marker2 = new google.maps.Marker({
                    //animation: google.maps.Animation.DROP,
                    position: location,
                    map,
				});
                marker2.addListener("click", () => {
                    infowindow.open(map, marker);
                });

				return marker;
			});
			new MarkerClusterer(map, markers, {
				imagePath:
					"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",
			});
		}

		function something() {
			return "";
		}

        function parseInitial(name) {
            if (name != " ") {
                var letter = name.charAt(0).toUpperCase() + name.slice(1);
                return letter.charAt(0).concat('.');
            }
            return "";
		}

        function capitalizeFirst(name) {
            if (name != " ") {
                var letter = name.charAt(0).toUpperCase() + name.slice(1);
                return letter;
            }
            return "";
        }

		function firstInitial() {
            if (window.lastFirstName == "") {
                return "";
            }
            if (window.lastFirstName != " ") {
				var letter = window.lastFirstName.charAt(0).toUpperCase() + window.lastFirstName.slice(1);
                return letter.charAt(0).concat('.');
			}
			return "";
		}

		function lastInitial() {
            if (window.lastLastName == "") {
                return "";
            }
			if (window.lastLastName != " ") {
				var letter = window.lastLastName.charAt(0).toUpperCase() + window.lastLastName.slice(1);
				return letter.charAt(0).concat('.');
			}
            return "";
		}

		function geocodeAddress(geocoder, resultsMap) {
			const address = document.getElementById("address").value;
			geocoder.geocode({ address: address }, (results, status) => {
				if (status === "OK") {
					resultsMap.setCenter(results[0].geometry.location);
					window.lastLat = results[0].geometry.location.lat();
					window.lastLng = results[0].geometry.location.lng();
                    callbackFunction();
					const infowindow = new google.maps.InfoWindow({
                        content: '<h1 class="harlow" style="color:#75aed9; text-align:center;">' + firstInitial() + '' + lastInitial() + '<br/>' + capitalizeFirst(window.lastCity) + '</h1>',
					});
                    //alert("HERE");
					var marker = new google.maps.Marker({
						map: resultsMap, // x
                        animation: google.maps.Animation.DROP, // x
                        position: new google.maps.LatLng(
                            results[0].geometry.location.lat() + ((Math.random() > 0.5 ? 0.001 : -0.009) + Math.random() * 0.008),
                            results[0].geometry.location.lng() + ((Math.random() > 0.5 ? 0.001 : -0.009) + Math.random() * 0.008)),
                        content: '<h1 class=""harlow"" style=""color:#75aed9; text-align:center;',
					});
					marker.setIcon(iconImage);
                    marker.addListener("click", () => {
                        infowindow.open(resultsMap, marker);
					});
                    new MarkerClusterer(map, markers, {
                        imagePath:
                            "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",
                    });
				}
				else {
					//alert(address);
				}
			});
		}
	</script>
</head>
<body>
	<div id="floating-panel">
		<input id="address" type="textbox" value="Sydney, NSW" />
		<input id="submit" type="button" value="Geocode" />
	</div>
	<div id="map"></div>
</body>
</html>